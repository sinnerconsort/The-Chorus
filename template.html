<!-- ===================================================================
     THE CHORUS — Main Panel Template
     Loaded via renderExtensionTemplateAsync('the-chorus', 'template')
     =================================================================== -->

<!-- FAB (Floating Action Button) — positioned in #sheld by panel.js -->
<div id="chorus-fab-wrapper">
    <button id="chorus-fab" title="The Chorus">
        <div class="chorus-fab__front">
            <span class="chorus-fab__glyph">◆</span>
        </div>
        <div class="chorus-fab__back">
            <span class="chorus-fab__back-glyph"></span>
            <span class="chorus-fab__back-name"></span>
            <span class="chorus-fab__back-badge">✦</span>
        </div>
    </button>
</div>

<!-- Panel Shell -->
<div id="chorus-panel">

    <!-- Header -->
    <div class="chorus-header">
        <div class="chorus-header__title">THE CHORUS</div>
        <div class="chorus-header__actions">
            <button class="chorus-header__btn" id="chorus-btn-narrator" title="Toggle Narrator"><i class="fa-solid fa-eye"></i></button>
            <button class="chorus-header__btn" id="chorus-btn-mute" title="Mute Voices"><i class="fa-solid fa-volume-xmark"></i></button>
            <button class="chorus-header__btn" id="chorus-btn-close" title="Close Panel"><i class="fa-solid fa-xmark"></i></button>
        </div>
    </div>

    <!-- Tab Bar -->
    <div class="chorus-tabs">
        <button class="chorus-tabs__btn active" data-tab="reading">
            <span class="chorus-tabs__icon"><i class="fa-solid fa-grip"></i></span>READING
        </button>
        <button class="chorus-tabs__btn" data-tab="deck">
            <span class="chorus-tabs__icon"><i class="fa-solid fa-layer-group"></i></span>DECK
        </button>
        <button class="chorus-tabs__btn" data-tab="council">
            <span class="chorus-tabs__icon"><i class="fa-solid fa-people-arrows"></i></span>COUNCIL
        </button>
        <button class="chorus-tabs__btn" data-tab="log">
            <span class="chorus-tabs__icon"><i class="fa-solid fa-scroll"></i></span>LOG
        </button>
        <button class="chorus-tabs__btn" data-tab="settings">
            <span class="chorus-tabs__icon"><i class="fa-solid fa-sliders"></i></span>SETTINGS
        </button>
    </div>

    <!-- Content Area -->
    <div class="chorus-content">

        <!-- ============ READING TAB ============ -->
        <div class="chorus-page active" id="chorus-page-reading">

            <!-- Escalation indicator -->
            <div class="chorus-escalation" id="chorus-escalation">
                <div class="chorus-escalation__bar">
                    <div class="chorus-escalation__fill" id="chorus-escalation-fill"></div>
                </div>
                <div class="chorus-escalation__label" id="chorus-escalation-label">CALM</div>
            </div>

            <!-- Spread type selector -->
            <div class="chorus-spread-pills" id="chorus-spread-pills">
                <button class="chorus-spread-pill active" data-spread="single">SINGLE</button>
                <button class="chorus-spread-pill" data-spread="three">THREE</button>
                <button class="chorus-spread-pill" data-spread="cross">CROSS</button>
            </div>

            <!-- Spread display area -->
            <div class="chorus-spread chorus-spread--single" id="chorus-spread-area">
                <!-- Slots injected here by JS -->
            </div>

            <!-- Draw button -->
            <button class="chorus-draw-btn" id="chorus-draw-btn">DRAW</button>

            <div class="chorus-divider"></div>

            <!-- Commentary area -->
            <div class="chorus-card" id="chorus-commentary-area">
                <div class="chorus-commentary-empty" id="chorus-commentary-empty">
                    <div class="chorus-commentary-empty__glyph">☾</div>
                    <div class="chorus-commentary-empty__text">Draw a spread to hear from your voices</div>
                </div>
                <!-- Commentary messages injected here by JS -->
            </div>

        </div>

        <!-- ============ DECK TAB ============ -->
        <div class="chorus-page" id="chorus-page-deck">

            <!-- Deck stats -->
            <div class="chorus-deck-stats" id="chorus-deck-stats">
                <div class="chorus-deck-stat">
                    <div class="chorus-deck-stat__val" id="chorus-stat-voices">0</div>
                    <div class="chorus-deck-stat__label">VOICES</div>
                </div>
                <div class="chorus-deck-stat">
                    <div class="chorus-deck-stat__val" id="chorus-stat-max">7</div>
                    <div class="chorus-deck-stat__label">MAX</div>
                </div>
                <div class="chorus-deck-stat">
                    <div class="chorus-deck-stat__val" id="chorus-stat-deaths">0</div>
                    <div class="chorus-deck-stat__label">DEATHS</div>
                </div>
            </div>

            <!-- Deck actions -->
            <div class="chorus-deck-actions">
                <button class="chorus-deck-action" id="chorus-btn-extract" title="Extract voices from persona">
                    <span class="chorus-deck-action__icon">&#x2726;</span>
                    <span class="chorus-deck-action__text">EXTRACT FROM PERSONA</span>
                </button>
            </div>

            <!-- Card spread (full-size tarot cards) -->
            <div class="chorus-card-spread" id="chorus-card-spread">
                <!-- Full cards injected here by JS -->
            </div>

        </div>

        <!-- ============ COUNCIL TAB ============ -->
        <div class="chorus-page" id="chorus-page-council">

            <!-- Active voice pips -->
            <div class="chorus-council-pips" id="chorus-council-pips">
                <!-- Pips injected here by JS -->
            </div>

            <!-- Council message feed -->
            <div class="chorus-council-feed" id="chorus-council-messages">
                <div class="chorus-council-empty">
                    <div class="chorus-council-empty__glyph">◇</div>
                    <div class="chorus-council-empty__text">Open this tab to convene the council</div>
                </div>
            </div>

            <!-- Council input -->
            <div class="chorus-council-input">
                <textarea class="chorus-council-input__field" id="chorus-council-input"
                    placeholder="Speak to the council..." rows="2"></textarea>
                <div class="chorus-council-input__actions">
                    <button class="chorus-council-input__send" id="chorus-council-send" title="Send">▸</button>
                    <button class="chorus-council-input__clear" id="chorus-council-clear" title="Clear history">✕</button>
                </div>
            </div>

        </div>

        <!-- ============ LOG TAB ============ -->
        <div class="chorus-page" id="chorus-page-log">

            <div class="chorus-sec-title">CHRONICLE</div>
            <div class="chorus-sec-sub">History of awakenings &amp; silencings</div>

            <div class="chorus-card" id="chorus-log-entries">
                <!-- Log entries injected here by JS -->
            </div>

        </div>

        <!-- ============ SETTINGS TAB ============ -->
        <div class="chorus-page" id="chorus-page-settings">

            <div class="chorus-sec-title">SETTINGS</div>
            <div class="chorus-sec-sub">Configure the chorus</div>

            <!-- Voice Engine -->
            <div class="chorus-card">
                <div class="chorus-settings-group">
                    <div class="chorus-settings-group__title">VOICE ENGINE</div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">CONNECTION</div>
                            <div class="chorus-setting__desc">API profile for voice generation</div>
                        </div>
                        <select class="chorus-select" id="chorus-setting-connection">
                            <option value="current">Current Profile</option>
                        </select>
                    </div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">TONE</div>
                            <div class="chorus-setting__desc">Flavor of voice personality</div>
                        </div>
                        <select class="chorus-select" id="chorus-setting-tone">
                            <option value="gothic">Gothic</option>
                            <option value="raw" selected>Raw</option>
                            <option value="clinical">Clinical</option>
                            <option value="surreal">Surreal</option>
                            <option value="baroque">Baroque</option>
                            <option value="noir">Noir</option>
                            <option value="feral">Feral</option>
                            <option value="sardonic">Sardonic</option>
                            <option value="mythic">Mythic</option>
                            <option value="tender">Tender</option>
                        </select>
                    </div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">NARRATOR</div>
                            <div class="chorus-setting__desc">Who narrates the inner world — each has an agenda</div>
                        </div>
                        <select class="chorus-select" id="chorus-setting-narrator">
                            <option value="stage_manager" selected>Stage Manager — watches the show</option>
                            <option value="therapist">Therapist — wants you healthy</option>
                            <option value="framing">Framing — pure atmosphere</option>
                            <option value="conscience">Conscience — the baseline self</option>
                            <option value="director">Director — wants drama</option>
                            <option value="archivist">Archivist — documents everything</option>
                            <option value="warden">Warden — wants control</option>
                            <option value="conspirator">Conspirator — sees patterns</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Deck -->
            <div class="chorus-card">
                <div class="chorus-settings-group">
                    <div class="chorus-settings-group__title">DECK</div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">MAX VOICES</div>
                            <div class="chorus-setting__desc">Maximum cards in your deck (22 = full Major Arcana)</div>
                        </div>
                        <div class="chorus-mini-slider">
                            <input type="range" id="chorus-setting-max-voices" min="3" max="22" value="7">
                            <div class="chorus-mini-slider__val" id="chorus-max-voices-val">7</div>
                        </div>
                    </div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">FULL DECK</div>
                            <div class="chorus-setting__desc">What happens when deck is full and a new voice triggers</div>
                        </div>
                        <div class="chorus-picker" id="chorus-setting-full-deck">
                            <button class="chorus-picker__opt active" data-value="block">BLOCK</button>
                            <button class="chorus-picker__opt" data-value="heal">HEAL</button>
                            <button class="chorus-picker__opt" data-value="merge">MERGE</button>
                            <button class="chorus-picker__opt" data-value="consume">CONSUME</button>
                        </div>
                    </div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">BIRTH SENSITIVITY</div>
                            <div class="chorus-setting__desc">How extreme events must be</div>
                        </div>
                        <div class="chorus-mini-slider">
                            <input type="range" id="chorus-setting-birth-sensitivity" min="1" max="5" value="3">
                            <div class="chorus-mini-slider__val" id="chorus-birth-sensitivity-val">MED</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Readings -->
            <div class="chorus-card">
                <div class="chorus-settings-group">
                    <div class="chorus-settings-group__title">READINGS</div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">DRAW MODE</div>
                            <div class="chorus-setting__desc">Auto draws a single card every message</div>
                        </div>
                        <div class="chorus-picker" id="chorus-setting-draw-mode">
                            <button class="chorus-picker__opt active" data-value="auto">AUTO</button>
                            <button class="chorus-picker__opt" data-value="manual">MANUAL</button>
                        </div>
                    </div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">SPREAD SEVERITY</div>
                            <div class="chorus-setting__desc">How intense an event must be to trigger a multi-card spread</div>
                        </div>
                        <div class="chorus-picker" id="chorus-setting-spread-severity">
                            <button class="chorus-picker__opt" data-value="low">LOW</button>
                            <button class="chorus-picker__opt active" data-value="medium">MED</button>
                            <button class="chorus-picker__opt" data-value="high">HIGH</button>
                        </div>
                    </div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">REVERSAL CHANCE</div>
                            <div class="chorus-setting__desc">% chance a card is reversed</div>
                        </div>
                        <div class="chorus-mini-slider">
                            <input type="range" id="chorus-setting-reversal-chance" min="0" max="50" step="5" value="15">
                            <div class="chorus-mini-slider__val" id="chorus-reversal-chance-val">15%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Influence -->
            <div class="chorus-card">
                <div class="chorus-settings-group">
                    <div class="chorus-settings-group__title">INFLUENCE</div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">GAIN RATE</div>
                            <div class="chorus-setting__desc">How fast voices grow</div>
                        </div>
                        <div class="chorus-mini-slider">
                            <input type="range" id="chorus-setting-gain-rate" min="1" max="5" value="3">
                            <div class="chorus-mini-slider__val" id="chorus-gain-rate-val">MED</div>
                        </div>
                    </div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">NATURAL DECAY</div>
                            <div class="chorus-setting__desc">Influence decreases over time</div>
                        </div>
                        <div class="chorus-toggle" id="chorus-setting-decay">
                            <div class="chorus-toggle__dot"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Council -->
            <div class="chorus-card">
                <div class="chorus-settings-group">
                    <div class="chorus-settings-group__title">COUNCIL</div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">AUTO-CONTINUE</div>
                            <div class="chorus-setting__desc">Voices keep talking on their own</div>
                        </div>
                        <div class="chorus-toggle on" id="chorus-setting-council-auto">
                            <div class="chorus-toggle__dot"></div>
                        </div>
                    </div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">SPEED</div>
                            <div class="chorus-setting__desc">How fast voices talk to each other</div>
                        </div>
                        <div class="chorus-picker" id="chorus-setting-council-speed">
                            <button class="chorus-picker__opt" data-value="fast">FAST</button>
                            <button class="chorus-picker__opt active" data-value="normal">NORMAL</button>
                            <button class="chorus-picker__opt" data-value="slow">SLOW</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hijack (future) -->
            <div class="chorus-card">
                <div class="chorus-settings-group">
                    <div class="chorus-settings-group__title">HIJACK SYSTEM</div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">ENABLED</div>
                            <div class="chorus-setting__desc">Allow voice interception</div>
                        </div>
                        <div class="chorus-toggle" id="chorus-setting-hijack">
                            <div class="chorus-toggle__dot"></div>
                        </div>
                    </div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label">MAX TIER</div>
                            <div class="chorus-setting__desc">Highest hijack level</div>
                        </div>
                        <div class="chorus-picker" id="chorus-setting-hijack-tier">
                            <button class="chorus-picker__opt active" data-value="1">T1</button>
                            <button class="chorus-picker__opt" data-value="2">T2</button>
                            <button class="chorus-picker__opt" data-value="3">T3</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="chorus-card chorus-card--danger">
                <div class="chorus-settings-group">
                    <div class="chorus-settings-group__title chorus-settings-group__title--danger">DANGER ZONE</div>

                    <div class="chorus-setting">
                        <div>
                            <div class="chorus-setting__label" style="color: var(--chorus-reversal)">SILENCE ALL</div>
                            <div class="chorus-setting__desc">Kill all voices, empty deck</div>
                        </div>
                        <button class="chorus-btn-danger" id="chorus-btn-reset">RESET</button>
                    </div>
                </div>
            </div>

        </div>

    </div><!-- /chorus-content -->

    <!-- Status Bar -->
    <div class="chorus-status">
        <div class="chorus-status__text" id="chorus-status-left">0 VOICES</div>
        <div class="chorus-status__pips" id="chorus-status-pips">
            <!-- Voice color pips injected here by JS -->
        </div>
        <div class="chorus-status__text" id="chorus-status-right">NO READING</div>
    </div>

</div><!-- /chorus-panel -->

<!-- Directory Overlay (1-on-1 voice chat) -->
<div class="chorus-directory-overlay" id="chorus-directory-overlay">
    <div class="chorus-directory-panel">
        <!-- Header -->
        <div class="chorus-directory__header" id="chorus-directory-header">
            <div class="chorus-directory__identity">
                <span class="chorus-directory__glyph" id="chorus-directory-glyph"></span>
                <div class="chorus-directory__info">
                    <div class="chorus-directory__name" id="chorus-directory-name"></div>
                    <div class="chorus-directory__meta">
                        <span id="chorus-directory-arcana"></span>
                        <span class="chorus-directory__sep">&middot;</span>
                        <span id="chorus-directory-relationship"></span>
                        <span class="chorus-directory__sep">&middot;</span>
                        <span id="chorus-directory-influence"></span>
                    </div>
                </div>
            </div>
            <button class="chorus-directory__close" id="chorus-directory-close">&times;</button>
        </div>

        <!-- Chat feed -->
        <div class="chorus-directory__feed" id="chorus-directory-feed"></div>

        <!-- Input -->
        <div class="chorus-directory__input-bar">
            <input type="text"
                   class="chorus-directory__input"
                   id="chorus-directory-input"
                   placeholder="Say something..."
                   autocomplete="off" />
            <button class="chorus-directory__send" id="chorus-directory-send">&rarr;</button>
        </div>
    </div>
</div>

<!-- Awakening Overlay (voice birth) -->
<div class="chorus-anim-overlay chorus-anim-overlay--awakening" id="chorus-awakening-overlay">
    <div class="chorus-anim__backdrop"></div>
    <div class="chorus-anim__card-stage">
        <div class="chorus-anim__particles" id="chorus-awakening-particles"></div>
        <div class="chorus-anim__card" id="chorus-awakening-card">
            <div class="chorus-anim__card-back">
                <div class="chorus-anim__card-back-pattern"></div>
            </div>
            <div class="chorus-anim__card-front" id="chorus-awakening-front">
                <div class="chorus-anim__card-glow" id="chorus-awakening-glow"></div>
                <div class="chorus-anim__card-glyph" id="chorus-awakening-glyph"></div>
                <div class="chorus-anim__card-name" id="chorus-awakening-name"></div>
                <div class="chorus-anim__card-arcana" id="chorus-awakening-arcana"></div>
                <div class="chorus-anim__card-depth" id="chorus-awakening-depth"></div>
                <div class="chorus-anim__card-ink" id="chorus-awakening-ink"></div>
                <div class="chorus-anim__scanlines"></div>
            </div>
        </div>
    </div>
    <div class="chorus-anim__label" id="chorus-awakening-label">A VOICE AWAKENS</div>
    <div class="chorus-anim__subtitle" id="chorus-awakening-subtitle"></div>
</div>

<!-- Dissolution Overlay (voice death/resolve) -->
<div class="chorus-anim-overlay chorus-anim-overlay--dissolution" id="chorus-dissolution-overlay">
    <div class="chorus-anim__backdrop"></div>
    <div class="chorus-anim__card-stage">
        <div class="chorus-anim__fragments" id="chorus-dissolution-fragments"></div>
        <div class="chorus-anim__card" id="chorus-dissolution-card">
            <div class="chorus-anim__card-front" id="chorus-dissolution-front">
                <div class="chorus-anim__card-glow" id="chorus-dissolution-glow"></div>
                <div class="chorus-anim__card-glyph" id="chorus-dissolution-glyph"></div>
                <div class="chorus-anim__card-name" id="chorus-dissolution-name"></div>
                <div class="chorus-anim__card-arcana" id="chorus-dissolution-arcana"></div>
                <div class="chorus-anim__scanlines"></div>
            </div>
        </div>
    </div>
    <div class="chorus-anim__label" id="chorus-dissolution-label">A VOICE FALLS SILENT</div>
    <div class="chorus-anim__subtitle" id="chorus-dissolution-subtitle"></div>
</div>

<!-- Transform Overlay (death → rebirth) -->
<div class="chorus-anim-overlay chorus-anim-overlay--transform" id="chorus-transform-overlay">
    <div class="chorus-anim__backdrop"></div>
    <div class="chorus-anim__card-stage">
        <div class="chorus-anim__fragments" id="chorus-transform-fragments"></div>
        <!-- Old card (shatters) -->
        <div class="chorus-anim__card chorus-anim__card--old" id="chorus-transform-old">
            <div class="chorus-anim__card-front" id="chorus-transform-old-front">
                <div class="chorus-anim__card-glyph" id="chorus-transform-old-glyph"></div>
                <div class="chorus-anim__card-name" id="chorus-transform-old-name"></div>
            </div>
        </div>
        <!-- New card (crystallizes) -->
        <div class="chorus-anim__card chorus-anim__card--new" id="chorus-transform-new">
            <div class="chorus-anim__card-front" id="chorus-transform-new-front">
                <div class="chorus-anim__card-glow" id="chorus-transform-new-glow"></div>
                <div class="chorus-anim__card-glyph" id="chorus-transform-new-glyph"></div>
                <div class="chorus-anim__card-name" id="chorus-transform-new-name"></div>
                <div class="chorus-anim__card-arcana" id="chorus-transform-new-arcana"></div>
                <div class="chorus-anim__card-depth" id="chorus-transform-new-depth"></div>
                <div class="chorus-anim__scanlines"></div>
            </div>
        </div>
    </div>
    <div class="chorus-anim__label" id="chorus-transform-label">TRANSFORMATION</div>
    <div class="chorus-anim__subtitle" id="chorus-transform-subtitle"></div>
</div>
